var LINQ = require('node-linq').LINQ;

var filter = function(jsonObject){
	
	var result;
	
	if (!jsonObject || !jsonObject.payload)
	{
		var erro = {"error": "Could not decode request: JSON parsing failed"};
		result = { "status" : 400, "exchange" : erro};
	}
	else
	{
		var filtered = new LINQ(jsonObject.payload)
			.Where(function(p){ return p.drm && p.episodeCount > 0 && p.image != undefined})
			.Select(function(p){ return { "image" : p.image.showImage, "slug" : p.slug, "title" : p.title } })
			.ToArray();
			
		var result = { "response" : filtered };	
		result = { "status" : 200, "exchange" : result};
	}
	
	return result;
};

module.exports.filterFullPayLoad = filter;
